@page "/shop/ready"
@using BlazorBday.Services
@inject OrderStateService OrderState
@inject NavigationManager Nav
@rendermode InteractiveServer

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-10">
            <StepIndicator CurrentStep="3" />

            <div class="card shadow">
                <div class="card-header bg-success text-white">
                    <h3 class="mb-0">Get Ready to Shop!</h3>
                </div>
                <div class="card-body">
                    <div class="alert alert-success">
                        <h4>Your Shopping Points: <strong>@OrderState.PointsAssigned points</strong></h4>
                        <p class="mb-0">Agency: <strong>@OrderState.AgencyName</strong></p>
                        <p class="mb-0">Child Age: <strong>@OrderState.ChildAge years</strong></p>
                    </div>

                    <h5 class="mt-4">How Shopping Works:</h5>
                    <ol class="lead">
                        <li><strong>Select a Card</strong> - Choose one special birthday card</li>
                        <li><strong>Select a Book</strong> - Pick one book to enjoy</li>
                        <li><strong>Select a Sweet Treat</strong> - Choose one delicious treat</li>
                        <li><strong>Select Gifts</strong> - Use your remaining points to pick gifts!</li>
                    </ol>

                    <div class="alert alert-info">
                        <strong>Remember:</strong> You must select a card, book, and treat before choosing gifts.
                        Your cart will show your remaining points as you shop!
                    </div>

                    <div class="d-grid gap-2 mt-4">
                        <button class="btn btn-success btn-lg" @onclick="StartShopping">
                            Start Shopping!
                        </button>
                        <button class="btn btn-secondary" @onclick="GoBack">
                            Back
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@code {
    protected override async Task OnInitializedAsync()
    {
        await OrderState.InitializeAsync();

        // Prerequisite checks
        if (OrderState.AgencyId == null)
        {
            Nav.NavigateTo("/shop/login");
            return;
        }

        if (OrderState.PointsAssigned == 0)
        {
            Nav.NavigateTo("/shop/demographics");
            return;
        }
    }

    private void StartShopping()
    {
        Nav.NavigateTo("/shop/card");
    }

    private void GoBack()
    {
        Nav.NavigateTo("/shop/demographics");
    }
}
